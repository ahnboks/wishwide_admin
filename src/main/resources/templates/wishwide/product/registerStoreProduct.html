<div th:insert="~{layout/head::head}"></div>
<!--<script src="/js/managerValidation.js"></script>-->

<div id="wrapper">

    <!-- 사이드바 START -->
    <div th:insert="~{layout/sidebar::sidebar}"></div>
    <!-- 사이드바 END -->

    <!-- 콘텐츠 START -->
    <div id="page-wrapper" class="gray-bg dashbard-1">
        <!-- 헤더 START-->
        <div th:insert="~{layout/header::header}"></div>
        <!-- 헤더 END-->

        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h2>상품 등록</h2>
                </div>
                <div class="ibox-content">
                    <!--폼 START-->
                    <form method="post" th:action="@{postRegisterStoreProduct}" class="form-horizontal" id="registerForm" enctype="multipart/form-data">
                        <!--선물등록여부-->
                        <div class="form-group">
                            <label class="col-sm-2 control-label">선물등록<label class="notnull-mark-color"> *</label></label>
                            <div class="col-sm-5">
                                <div class="checkbox checkbox-primary">
                                    <input type="checkbox" class="form-control-static checkbox-primary" aria-label="Single checkbox Two"
                                           name="giftProductRegisterCode" value="0" >
                                    <label></label>
                                </div>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--가맹점명-->
                        <div class="form-group" sec:authorize="hasRole('MA')" >
                            <label class="col-sm-2 control-label">가맹점명</label>
                            <div class="col-sm-3">
                                <select data-placeholder="가맹점 선택" class="chosen-select" name="productOwnerId" tabindex="2">
                                    <option value="ALL">전체</option>
                                    <option th:each="store:${storeNameList}" th:value="${store[0]}">[[${store[1]}]]</option>
                                </select>
                            </div>
                        </div>

                        <!--가맹점명-->
                        <div class="form-group" sec:authorize="hasRole('ST')">
                            <input type="hidden" th:value="${storeId}" name="productOwnerId">
                        </div>

                        <!--상품카테고리-->
                        <div class="form-group" sec:authorize="hasRole('MA')">
                            <label class="col-sm-2 control-label">상품 카테고리<label class="notnull-mark-color"> *</label></label>
                            <div class="col-sm-2" id="majorCategoryNo">
                                <select class="form-control m-b" name="majorCategoryNo">
                                    <option value="0">대분류 선택</option>
                                </select>
                            </div>
                            <div class="col-sm-2" id="subCategoryName" style="display: none">
                                <select class="form-control m-b" name="subCategoryNo">
                                </select>
                            </div>
                        </div>

                        <!--상품카테고리-->
                        <div class="form-group" sec:authorize="hasRole('ST')">
                            <label class="col-sm-2 control-label">상품 카테고리</label>
                                <div class="col-sm-2">
                                    <select class="form-control m-b" name="majorCategoryNo">
                                        <option value="ALL">전체</option>
                                        <option th:each="category:${categoryList}" th:value="${category[0]}">[[${category[2]}]]</option>
                                    </select>
                                </div>
                                <div class="col-sm-2" id="subCategory" style="display: none">
                                    <select class="form-control m-b" name="subCategoryNo">
                                    </select>
                                </div>
                        </div>

                        <div class="hr-line-dashed"></div>

                        <!--할인여부-->
                        <div class="form-group" id="productDiscountCode">
                            <label class="col-sm-2 control-label">할인여부<label class="notnull-mark-color"> *</label></label>
                            <div class="col-sm-5">
                                <label class="radio-inline"><input type="radio" name="productDiscountCode" value="0">미사용</label>
                                <label class="radio-inline"><input type="radio" name="productDiscountCode" value="1">사용</label>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--할인타입-->
                        <div class="form-group" id="productDiscountTypeCode" style="display:none;">
                            <label class="col-sm-2 control-label">할인타입<label class="notnull-mark-color"> *</label></label>
                            <div class="col-sm-5">
                                <label class="radio-inline"><input type="radio" name="productDiscountTypeCode" value="DCR">할인율</label>
                                <label class="radio-inline"><input type="radio" name="productDiscountTypeCode" value="DCP">할인가</label>
                            </div>
                        </div>

                        <!--할인값-->
                        <div class="form-group" id="productDiscountValue" style="display: none" >
                            <label class="col-sm-2 control-label">할인값<label class="notnull-mark-color"> *</label></label>
                            <div class="row">
                                <div class="col-sm-2">
                                    <label class="control-label"><input class="form-control" maxlength="5" type="text" onkeypress="InputOnlyNumber(this);" name="productDiscountValue"></label>
                                </div>
                                <div class="col-sm-1" id="productDiscountPrice">
                                    <label class="control-label">원</label>
                                </div>
                                <div class="col-sm-1" id="productDiscountRate">
                                    <label class="control-label">%</label>
                                </div>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--상품명-->
                        <div class="form-group">
                            <label class="col-sm-2 control-label">상품명<label class="notnull-mark-color"> *</label></label>
                            <div class="col-sm-7">
                                <div class="col-sm-12">
                                    <div class="row">
                                        <div class="col-sm-5">
                                            <input type="text" maxlength="20" class="form-control" name="productTitle">
                                            <span class="msg-operator-name-input-validation"></span>
                                        </div>
                                        <div class="col-sm-7">
                                            <a href="#" name="addSubProduct">
                                                <i class="fa fa-plus-circle"></i>
                                            </a><label class="form-control-static" > 서브상품 추가</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12" id="sub1" style="display:none;">
                                    <div class="hr-line-dashed"></div>
                                    <label class="col-sm-2 form-control-static"><a href="#" name="minusSubProduct" class="minusSubProduct"><i class="fa fa-minus-circle"></i></a>서브상품명</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="20" class="form-control" name="subProductName">
                                    </div>
                                    <label class="col-sm-2 form-control-static">서브상품가(원)</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="6" class="form-control" name="subProductPrice" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                    <label class="col-sm-2 form-control-static">할인값</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="5" class="form-control" name="subProductDiscountValue" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                </div>
                                <div class="col-sm-12" id="sub2" style="display:none;">
                                    <div class="hr-line-dashed"></div>
                                    <label class="col-sm-2 form-control-static"><a href="#" name="minusSubProduct" class="minusSubProduct"><i class="fa fa-minus-circle"></i></a>서브상품명</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="20" class="form-control" name="subProductName">
                                    </div>
                                    <label class="col-sm-2 form-control-static">서브상품가(원)</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="6" class="form-control" name="subProductPrice" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                    <label class="col-sm-2 form-control-static">할인값</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="5" class="form-control" name="subProductDiscountValue" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                </div>
                                <div class="col-sm-12" id="sub3" style="display:none;">
                                    <div class="hr-line-dashed"></div>
                                    <label class="col-sm-2 form-control-static"><a href="#" name="minusSubProduct" class="minusSubProduct"><i class="fa fa-minus-circle"></i></a>서브상품명</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="20" class="form-control" name="subProductName">
                                    </div>
                                    <label class="col-sm-2 form-control-static">서브상품가(원)</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="6" class="form-control" name="subProductPrice" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                    <label class="col-sm-2 form-control-static">할인값</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="5" class="form-control" name="subProductDiscountValue" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                </div>
                                <div class="col-sm-12" id="sub4" style="display:none;">
                                    <div class="hr-line-dashed"></div>
                                    <label class="col-sm-2 form-control-static"><a href="#" name="minusSubProduct" class="minusSubProduct"><i class="fa fa-minus-circle"></i></a>서브상품명</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="20" class="form-control" name="subProductName">
                                    </div>
                                    <label class="col-sm-2 form-control-static">서브상품가(원)</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="6" class="form-control" name="subProductPrice" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                    <label class="col-sm-2 form-control-static">할인값</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="5" class="form-control" name="subProductDiscountValue" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                </div>
                                <div class="col-sm-12" id="sub5" style="display:none;">
                                    <div class="hr-line-dashed"></div>
                                    <label class="col-sm-2 form-control-static"><a href="#" name="minusSubProduct" class="minusSubProduct"><i class="fa fa-minus-circle"></i></a>서브상품명</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="20" class="form-control" name="subProductName">
                                    </div>
                                    <label class="col-sm-2 form-control-static">서브상품가(원)</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="6" class="form-control" name="subProductPrice" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                    <label class="col-sm-2 form-control-static">할인값</label>
                                    <div class="col-sm-2">
                                        <input type="text" maxlength="5" class="form-control" name="subProductDiscountValue" onkeypress="InputOnlyNumber(this);" >
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--판매가격-->
                        <div class="form-group" id="productPrice">
                            <label class="col-sm-2 control-label">판매가격(원)<label class="notnull-mark-color"> *</label></label>
                            <div class="col-sm-2">
                                <input type="text" maxlength="5" class="form-control" value="0" name="productPrice" onkeypress="InputOnlyNumber(this);">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--상품 이미지-->
                        <div class="form-group">
                            <label class="col-sm-2 control-label">이미지<label class="notnull-mark-color"> *</label></label>
                            <div class="col-sm-2">
                                <div class="fileinput fileinput-new" data-provides="fileinput" id="file1">
                                    <div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 100px; height: 80px;"></div>
                                    <span class="fileinput-filename"></span>
                                    <div>
                                        <span class="btn btn-default btn-file">
                                            <span class="fileinput-new">파일 선택</span>
                                            <span class="fileinput-exists">파일 변경</span>
                                            <input type="file" name="productImage" id="productImage" class="file-validation" onchange="fileUploadValidation(this, 'image', '1')"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--묶음할인-->
                        <div class="form-group" id="giftProductDiscountUse" style="display: none" >
                            <label class="col-sm-2 control-label">묶음 할인<label class="notnull-mark-color"> *</label></label>
                            <div class="col-sm-5">
                                <label class="radio-inline"><input type="radio" name="giftBundleDiscountCode" value="0">미사용</label>
                                <label class="radio-inline"><input type="radio" name="giftBundleDiscountCode" value="1">사용</label>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--묶음할인 정보-->
                        <div class="form-group" id="giftBundleDiscountInfo" style="display: none">
                            <div class="col-sm-offset-1 col-md-10" >
                                <div class="panel panel-default ">
                                    <div class="panel-heading"><h5>묶음할인 정보</h5></div>
                                    <div class="panel-body">
                                        <div class="panel-group">
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">묶음할인시작수량</label>
                                                <div class="col-sm-1">
                                                    <input type="text" maxlength="2" class="form-control " name="giftBundleDiscountInitQuantity" onkeypress="InputOnlyNumber(this);">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label">할인타입</label>
                                                <div class="col-sm-3">
                                                    <div class="row">
                                                        <div class="col-sm-4">
                                                            <label class="radio-inline"><input type="radio" name="giftBundleDiscountTypeCode" value="DCR">할인율</label>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <label class="radio-inline"><input type="radio" name="giftBundleDiscountTypeCode" value="DCP">할인가</label>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div id="DCPValue" style="display: none;">
                                                            <label class="control-label"><input class="form-control" maxlength="5" type="text" onkeypress="InputOnlyNumber(this);" name="DCPValue"></label>
                                                            <label class="control-label">원</label>
                                                        </div>
                                                        <div id="DCRValue" style="display: none;">
                                                            <label class="control-label"><input class="form-control" maxlength="3" type="text" onkeypress="InputOnlyNumber(this);" name="DCRValue"></label>
                                                            <label class="control-label">%</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="giftBundleDiscountValue">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--메모-->
                        <div class="form-group">
                            <label class="col-sm-2 control-label">설명</label>
                            <div class="col-sm-2">
                                <textarea class="form-control" name="productDescription" rows="7"></textarea>
                                <span class="textarea-limit-validation"></span>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>

                        <!--수정, 목록 버튼-->
                        <div class="form-group">
                            <div class="text-center">
                                <button class="btn btn-primary" type="submit" id="btnSubmit">등록</button>
                                <a th:href="@{/wishwide/product/listStoreProduct(page=${pageVO.page}, size=${pageVO.size}, type=${pageVO.type}, keyword=${pageVO.keyword})}">
                                    <button class="btn btn-white" type="button" id="btnList">목록</button>
                                </a>
                            </div>
                        </div>
                        <input type="hidden" name="page" th:value="${pageVO.page}"/>
                        <input type="hidden" name="size" th:value="${pageVO.size}"/>
                        <input type="hidden" name="keyword" th:value="${pageVO.keyword}"/>
                    </form>
                </div>
            </div>
        </div>

        <!-- 푸터 START-->
        <div th:insert="~{layout/footer::footer}"/>
        <!-- 푸터 END -->
    </div>
    <!-- 콘텐츠 END -->
</div>
<th:block >
<script th:inline="javascript">
    var registerForm = $('#registerForm');

    $(document).ready(function () {

        $('.chosen-select').chosen({width: "100%"});

        //매장명에 따른 대분류명
        registerForm.find('[name="productOwnerId"]').change(function () {
            var productOwnerId = registerForm.find('[name="productOwnerId"]').val();

            $.ajax({
                url: "/wishwide/product/selectMajorCategory/" + productOwnerId,
                type: 'get',
                contentType: 'application/json',
                success: function (data) {
                    console.log(data);
                    if (data.length != 0) {
                        registerForm.find('[name="majorCategoryNo"] option').remove();

                        if (data.length == 1) {
                            $.each(data, function (index, item) {
                                console.log(item);

                                registerForm.find('[name="majorCategoryNo"]').append(
                                    '<option value="' + item[0] + '" >' + item[2] + '</option>'
                                );

                                var majorCategoryNo = item[0];
                                selectSubCategory(majorCategoryNo);
                            });
                        }
                        else {
                            $.each(data, function (index, item) {
                                console.log(item);

                                registerForm.find('[name="majorCategoryNo"]').append(
                                    '<option value="' + item[0] + '" >' + item[2] + '</option>'
                                );

                                //등록된 중분류가 없을 시
                                if (item[3] == 0) {
                                    registerForm.find('[name="subCategoryNo"] option').remove();
                                    registerForm.find('[name="subCategoryNo"]').append('<option value="0">중분류 선택</option>');
                                    $('#subCategoryName').css('display', 'none');
                                    $('#subCategory').css('display', 'none');
                                }
                            });
                        }
                    }
                    else {
                        console.log('데이터없음');
                        registerForm.find('[name="majorCategoryNo"] option').remove();
                        registerForm.find('[name="majorCategoryNo"]').append('<option value="0">대분류 선택</option>');
                        registerForm.find('[name="subCategoryNo"] option').remove();
                        registerForm.find('[name="subCategoryNo"]').append('<option value="0">중분류 선택</option>');
                        $('#subCategoryName').css('display', 'none');
                        $('#subCategory').css('display', 'none');

                        alert('등록된 카테고리가 없습니다.');
                    }
                }
            });
        });

        //대분류에 따른 중분류명
        registerForm.find('[name="majorCategoryNo"]').change(function () {
            var majorCategoryNo = registerForm.find('[name="majorCategoryNo"]').val();

            selectSubCategory(majorCategoryNo);
        });

        var subProductCnt = 1;

        //선물등록 코드에 따른 CSS
        registerForm.find('[name="giftProductRegisterCode"]').change(function (e) {

            var giftBundleDiscountCode = registerForm.find('[name="giftBundleDiscountCode"]:checked').val();
            var isChecked = $("input:checkbox[name='giftProductRegisterCode']").prop("checked");

            console.log(isChecked);

            //체크여부 확인
            if (isChecked) {
                registerForm.find('[name="giftProductRegisterCode"]').attr('value', 1);
            }
            else {
                registerForm.find('[name="giftProductRegisterCode"]').attr('value', 0);
            }

            var giftProductRegisterCode = registerForm.find('[name="giftProductRegisterCode"]:checked').val();

            console.log(giftProductRegisterCode + '값');

            if (giftProductRegisterCode == 1) {

                $('#giftProductDiscountUse').css('display', 'block');
                $('#giftProductDiscountPrice').css('display', 'block');

                if (giftBundleDiscountCode == 1)
                    $('#giftBundleDiscountInfo').css('display', 'block');
            }
            else {
                $('#giftProductDiscountUse').css('display', 'none');
                $('#giftBundleDiscountInfo').css('display', 'none');
                $('#giftProductDiscountPrice').css('display', 'none');

            }
        });

        //할인 사용여부에 따른 CSS
        registerForm.find('[name="productDiscountCode"]').change(function (e) {
            var productDiscountCode = registerForm.find('[name="productDiscountCode"]:checked').val();

            console.log(productDiscountCode + '값');

            if (productDiscountCode == 1) {
                $('#productDiscountTypeCode').css('display', 'block');

                registerForm.find('[name="subProductDiscountValue"]').val('');
                registerForm.find('[name="subProductDiscountValue"]').attr("readonly", false);
            }
            else {
                $('#productDiscountTypeCode').css('display', 'none');
                $('#productDiscountValue').css('display', 'none');

                registerForm.find('[name="subProductDiscountValue"]').val(0);
                registerForm.find('[name="subProductDiscountValue"]').attr("readonly", true);
            }
        });

        //할인타입코드에 따른 CSS
        registerForm.find('[name="productDiscountTypeCode"]').change(function (e) {
            var productDiscountTypeCode = registerForm.find('[name="productDiscountTypeCode"]:checked').val();

            console.log(productDiscountTypeCode + '값');

            if($("#sub1").css("display") == "block"){
                $('#productDiscountValue').css('display', 'none');
                $('#productDiscountPrice').css('display', 'none');
                $('#productDiscountRate').css('display', 'none');

                return false;
            }

            $('#productDiscountValue').css('display', 'block');

            if(productDiscountTypeCode == 'DCP'){
                $('#productDiscountPrice').css('display', 'block');
                $('#productDiscountRate').css('display', 'none');
            }
            else{
                $('#productDiscountRate').css('display', 'block');
                $('#productDiscountPrice').css('display', 'none');
            }

        });

        //묶음할인 사용여부에 따른 CSS
        registerForm.find('[name="giftBundleDiscountCode"]').change(function (e) {
            var giftBundleDiscountCode = registerForm.find('[name="giftBundleDiscountCode"]:checked').val();

            console.log(giftBundleDiscountCode + '값');

            if (giftBundleDiscountCode == 1) {
                $('#giftBundleDiscountInfo').css('display', 'block');
            }
            else {
                $('#giftBundleDiscountInfo').css('display', 'none');
            }
        });

        //묶음할인타입에 따른 CSS
        registerForm.find('[name="giftBundleDiscountTypeCode"]').change(function () {
            var giftBundleDiscountTypeCode = registerForm.find('[name="giftBundleDiscountTypeCode"]:checked').val();

            if (giftBundleDiscountTypeCode == 'DCR') {
                $("#DCRValue").css('display', 'block');
                $("#DCPValue").css('display', 'none');
            }
            else {
                $("#DCPValue").css('display', 'block');
                $("#DCRValue").css('display', 'none');
            }
        });

        //서브상품 추가
        $('a[name="addSubProduct"]').click(function (e) {
            e.preventDefault();

            var productDiscountCode = registerForm.find('[name="productDiscountCode"]:checked').val();
            var productDiscountTypeCode = registerForm.find('[name="productDiscountTypeCode"]:checked').val();

            if (productDiscountCode == undefined) {
                alert('할인여부를 선택해주세요.');
                return false;
            }

            if (subProductCnt == 1) {
                $('#sub1').css('display', 'block');
                subProductCnt++;

                $('#productPrice').css('display', 'none');
                $('#productDiscountValue').css('display', 'none');
            }
            else if (subProductCnt == 2) {
                $('#sub2').css('display', 'block');
                subProductCnt++;
            }
            else if (subProductCnt == 3) {
                $('#sub3').css('display', 'block');
                subProductCnt++;
            }
            else if (subProductCnt == 4) {
                $('#sub4').css('display', 'block');
                subProductCnt++;
            }
            else if (subProductCnt == 5) {
                $('#sub5').css('display', 'block');
                subProductCnt++;
            }
            else {
                alert('서브상품은 최대 5개까지 등록 가능합니다.');
            }

//                var parentNode = $(this).parent().parent().parent();
//
//                parentNode.append('<div class="col-sm-12">' +
//                    '<div class="hr-line-dashed"></div>' +
//                    '<label class="col-sm-3 "><a href="#" name="minusSubProduct" class="minusSubProduct"><i class="fa fa-minus-circle"></i></a>서브상품명</label>' +
//                    '<div class="col-sm-3"><input type="text" maxlength="20" class="form-control" name="productTitle"></div>' +
//                    '<label class="col-sm-3 ">서브상품가격</label>' +
//                    '<div class="col-sm-3"><input type="text" maxlength="20" class="form-control" name="productTitle"></div>' +
//                    '</div>');
//
//                console.log(parentNode);

        });

        //서브상품 제거
        $('.minusSubProduct').click(function (e) {
            e.preventDefault();

            if (subProductCnt == 2) {
                $('#sub1').css('display', 'none');
                $('#productPrice').css('display', 'block');

                var productDiscountCode = registerForm.find('[name="productDiscountCode"]:checked').val();

                //할인사용시 할인타입 보이기
                if (productDiscountCode == 1) {
                    $('#productDiscountTypeCode').css('display', 'block');
                }

                subProductCnt--;
            }
            else if (subProductCnt == 3) {
                $('#sub2').css('display', 'none');
                subProductCnt--;
            }
            else if (subProductCnt == 4) {
                $('#sub3').css('display', 'none');
                subProductCnt--;
            }
            else if (subProductCnt == 5) {
                $('#sub4').css('display', 'none');
                subProductCnt--;
            }
            else if (subProductCnt == 6) {
                $('#sub5').css('display', 'none');
                subProductCnt--;
            }

        });

        $('#btnSubmit').click(function (e) {
//                e.preventDefault();

            if (confirm('등록하시겠습니까?') != true) return false;

            var giftProductRegisterCode = registerForm.find('[name="giftProductRegisterCode"]:checked').val();
            var productOwnerId = registerForm.find('[name="productOwnerId"]').val();
            var productTitle = registerForm.find('[name="productTitle"]').val();
            var majorCategoryNo = registerForm.find('[name="majorCategoryNo"]').val();
            var productDiscountValue = registerForm.find('[name="productDiscountValue"]').val();
            var productDiscountCode = registerForm.find('[name="productDiscountCode"]:checked').val();

            var productDiscountTypeCode = registerForm.find('[name="productDiscountTypeCode"]:checked').val();
            var giftBundleDiscountCode = registerForm.find('[name="giftBundleDiscountCode"]:checked').val();
            var giftBundleDiscountTypeCode = registerForm.find('[name="giftBundleDiscountTypeCode"]:checked').val();
            var giftBundleDiscountInitQuantity = registerForm.find('[name="giftBundleDiscountInitQuantity"]').val();
            var DCPValue = registerForm.find('[name="DCPValue"]').val();
            var DCRValue = registerForm.find('[name="DCRValue"]').val();

            /*유효성 검사*/

            //서브상품 유효성
            if ($("#sub1").css("display") == "block") {
                var element = $("#sub1");

//                    subProductValidation(element);
                if (!subProductValidation(element, 0)) return false;

                registerForm.find('[name="productDiscountValue"]').val('0');
            }
            else {
                var element = $("#sub1");
                var productPrice = registerForm.find('[name="productPrice"]').val();

                element.find('[name="subProductName"]').attr('value', 'none');
                element.find('[name="subProductPrice"]').attr('value', 0);
                element.find('[name="subProductDiscountValue"]').attr('value', 0);

                renameForModelAttribute(element, 0);

                if (productDiscountCode == 1) {
                    if (productDiscountTypeCode == 'DCR') {
                        if (productDiscountValue == '') {
                            alert('할인률을 입력해주세요');
                            return false;
                        }
                        else if (parseInt(productDiscountValue) > 100) {
                            alert('할인률은 100%까지 입력가능합니다.');
                            return false;
                        }
                    }
                    if (productDiscountTypeCode == 'DCP') {
                        if (productDiscountValue == '') {
                            alert('할인가를 입력해주세요');
                            return false;
                        }
                        else if (parseInt(productDiscountValue) > parseInt(productPrice)) {
                            alert('할인가는 상품가격보다 크게 입력이 불가능합니다.');
                            return false;
                        }
                    }
                }
                else{
                    registerForm.find('[name="productDiscountValue"]').val('0');
                }

                if (productPrice == 0) {
                    alert('상품가격은 0원이상으로 입력해주세요.');
                    return false;
                }
            }

            if ($("#sub2").css("display") == "block") {
                var element = $("#sub2");

                if (!subProductValidation(element, 1)) return false;
            }

            if ($("#sub3").css("display") == "block") {
                var element = $("#sub3");

                if (!subProductValidation(element, 2)) return false;
            }

            if ($("#sub4").css("display") == "block") {
                var element = $("#sub4");

                if (!subProductValidation(element, 3)) return false;
            }

            if ($("#sub5").css("display") == "block") {
                var element = $("#sub5");

                if (!subProductValidation(element, 4)) return false;
            }

            if (giftProductRegisterCode == undefined) {
                registerForm.find('[name="giftBundleDiscountInitQuantity"]').val('0');
                console.log(registerForm.find('[name="giftBundleDiscountInitQuantity"]').val());
            }

            if (productOwnerId == 'ALL') {
                alert('가맹점을 선택해주세요.');
                return false;
            }
            if (majorCategoryNo == 0) {
                alert('상품 카테고리를 선택해주세요.');
                return false;
            }
            if (productTitle == '') {
                alert('상품명을 입력해주세요.');
                return false;
            }
            if (productDiscountCode == '') {
                alert('할인여부를 선택해주세요.');
                return false;
            }
            if (productDiscountTypeCode == '') {
                alert('할인타입을 선택해주세요.');
                return false;
            }
            if (giftBundleDiscountCode == '') {
                alert('묶음할인여부를 선택해주세요.');
                return false;
            }
            else {
                if (giftBundleDiscountCode == 1) {
                    if (giftBundleDiscountTypeCode == 'DCR') {
                        if (DCRValue == '') {
                            alert('할인률을 입력해주세요');
                            return false;
                        }
                        else if (parseInt(DCRValue) > 100) {
                            alert('할인률은 100%까지 입력가능합니다.');
                            return false;
                        }
                        else {
                            registerForm.find('[name="giftBundleDiscountValue"]').val(DCRValue);
                        }
                    }
                    var productPrice = registerForm.find('[name="productPrice"]').val();
                    if (giftBundleDiscountTypeCode == 'DCP') {
                        if (DCPValue == '') {
                            alert('할인가를 입력해주세요');
                            return false;
                        }
                        else if (parseInt(DCPValue) > parseInt(productPrice)) {
                            alert('할인가는 상품가격보다 크게 입력이 불가능합니다.');
                            return false;
                        }
                        else {
                            registerForm.find('[name="giftBundleDiscountValue"]').val(DCPValue);
                        }
                    }

                    if (giftBundleDiscountInitQuantity == '') {
                        alert('묶음할인 시작수량을 입력해주세요.');
                        return false;
                    }
                }
                else {
                    registerForm.find('[name="giftBundleDiscountValue"]').val('0');
                    registerForm.find('[name="giftBundleDiscountInitQuantity"]').val('0');
                }
            }

            var productImage = $('input[name="productImage"]').val();

            console.log(productImage);

            if (productImage == '') {
                alert('이미지를 등록해주세요');
                return false;
            }

            console.log(giftBundleDiscountTypeCode);
        });

        });


    function selectSubCategory(majorCategoryNo) {
        $.ajax({
            url: "/wishwide/product/selectSubCategory/" + majorCategoryNo,
            type: 'get',
            contentType: 'application/json',
            success: function (data) {
                console.log(data);
                if (data.length != 0) {
                    $('#subCategoryName').css('display', 'block');
                    $('#subCategory').css('display', 'block');
                    registerForm.find('[name="subCategoryNo"] option').remove();

                    $.each(data, function (index, item) {
                        console.log(item);

                        registerForm.find('[name="subCategoryNo"]').append(
                            '<option value="' + item[0] + '" >' + item[2] + '</option>'
                        );
                    });
                }
                else {
                    console.log('데이터없음');

                    registerForm.find('[name="subCategoryNo"] option').remove();
                    registerForm.find('[name="subCategoryNo"]').append('<option value="0">중분류 선택</option>');
                    $('#subCategoryName').css('display', 'none');
                    $('#subCategory').css('display', 'none');

                    alert('등록된 중분류가 없습니다.');
                }
            }
        });
    }

    function renameForModelAttribute(element, index) {
        $(element).find("input[name=subProductName]").attr("name", "subProductList[" + index + "].subProductName");
        $(element).find("input[name=subProductPrice]").attr("name", "subProductList[" + index + "].subProductPrice");
        $(element).find("input[name=subProductDiscountValue]").attr("name", "subProductList[" + index + "].subProductDiscountValue");
    }

    function subProductValidation(element, index) {
        var productDiscountTypeCode = registerForm.find('[name="productDiscountTypeCode"]:checked').val();

        var subProductName = '';
        var subProductPrice = '';
        var subProductDiscountValue = element.find('[name="subProductDiscountValue"]').val();

        console.log(productDiscountTypeCode)
        console.log(subProductDiscountValue)

        if (subProductDiscountValue != undefined) {
            subProductName = element.find('[name="subProductName"]').val();
            subProductPrice = element.find('[name="subProductPrice"]').val();
            subProductDiscountValue = element.find('[name="subProductDiscountValue"]').val();
        }
        else {
            subProductName = element.find('[name="subProductList[' + index + '].subProductName"]').val();
            subProductPrice = element.find('[name="subProductList[' + index + '].subProductPrice"]').val();
            subProductDiscountValue = element.find('[name="subProductList[' + index + '].subProductDiscountValue"]').val();
        }

        if(subProductName == '' || subProductPrice == '' || subProductDiscountValue == ''){
            alert('서브상품 정보를 입력해주세요.');
            return false;
        }
        else {
            if (productDiscountTypeCode == 'DCR') {
                if (parseInt(subProductDiscountValue) > 100) {
                    alert('할인률은 100%까지 입력가능합니다.');
                    return false;
                }
            }
            else if (productDiscountTypeCode == 'DCP') {
                if (parseInt(subProductDiscountValue) >= parseInt(subProductPrice)) {
                    alert('할인가는 상품가격보다 크게 입력이 불가능합니다.');
                    return false;
                }
            }

            registerForm.find('[name="productPrice"]').val(subProductPrice);
            renameForModelAttribute(element, index);
        }

        return true;
    };

</script>
</th:block>


